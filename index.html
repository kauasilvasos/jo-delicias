<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jo Del√≠cias - Monte sua Marmita</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        :root { --primary: #D65A18; --bg: #FDF6E3; --white: #fff; }
        body { font-family: 'Poppins', sans-serif; background: var(--bg); margin: 0; color: #2C3E50; }
        
        header { background: var(--primary); color: var(--white); text-align: center; padding: 20px; border-radius: 0 0 20px 20px; }
        .container { max-width: 600px; margin: 20px auto; padding: 0 20px; }
        
        .section-title { color: var(--primary); border-bottom: 2px solid var(--primary); margin-top: 30px; }
        
        /* Grid de Op√ß√µes */
        .options-grid { display: grid; grid-template-columns: 1fr; gap: 10px; }
        label { background: var(--white); padding: 12px; border-radius: 8px; display: flex; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        input[type="checkbox"] { accent-color: var(--primary); margin-right: 10px; transform: scale(1.2); }

        /* Bot√£o Principal */
        button {
            background-color: #25D366; color: white; border: none; width: 100%; padding: 15px;
            font-size: 1.1rem; font-weight: bold; border-radius: 50px; cursor: pointer; margin: 40px 0 60px 0;
            box-shadow: 0 4px 15px rgba(37, 211, 102, 0.4);
        }

        /* √Årea Oculta da Imagem */
        #pedido-imagem {
            background: white; padding: 20px; border: 4px solid var(--primary);
            position: fixed; top: -9999px; left: -9999px; width: 400px; /* Largura fixa para boa resolu√ß√£o */
            color: #000; font-family: 'Poppins', sans-serif;
        }
        ul { padding-left: 20px; margin: 5px 0; }
    </style>
</head>
<body>

<header>
    <h1>Jo Del√≠cias</h1>
    <p>Monte sua Marmita</p>
</header>

<div class="container">
    <div style="background:#fff3cd; color:#856404; padding:10px; border-radius:5px; font-size:0.9rem;">
        <strong>Regra do Pacote:</strong> M√≠nimo 10 marmitas (5 carne / 5 frango).
    </div>

    <form id="marmitaForm">
        
        <h3 class="section-title">1. Carboidratos (M√°x 2)</h3>
        <div class="options-grid">
            <label><input type="checkbox" name="carbo" value="Arroz Integral" onclick="checkLimit(this, 2)"> Arroz Integral</label>
            <label><input type="checkbox" name="carbo" value="Arroz Branco" onclick="checkLimit(this, 2)"> Arroz Branco</label>
            <label><input type="checkbox" name="carbo" value="Arroz Parboilizado" onclick="checkLimit(this, 2)"> Arroz Parboilizado</label>
            <label><input type="checkbox" name="carbo" value="Macarr√£o Espaguete" onclick="checkLimit(this, 2)"> Macarr√£o Espaguete</label>
            <label><input type="checkbox" name="carbo" value="Macarr√£o Penne" onclick="checkLimit(this, 2)"> Macarr√£o Penne</label>
            <label><input type="checkbox" name="carbo" value="Macarr√£o de Arroz (s/ gl√∫ten)" onclick="checkLimit(this, 2)"> Macarr√£o Arroz s/ Gl√∫ten</label>
            <label><input type="checkbox" name="carbo" value="Batata Baroa" onclick="checkLimit(this, 2)"> Batata Baroa</label>
            <label><input type="checkbox" name="carbo" value="Batata Inglesa" onclick="checkLimit(this, 2)"> Batata Inglesa</label>
            <label><input type="checkbox" name="carbo" value="Aipim" onclick="checkLimit(this, 2)"> Aipim</label>
            <label><input type="checkbox" name="carbo" value="Ab√≥bora Cabotia" onclick="checkLimit(this, 2)"> Ab√≥bora Cabotia</label>
            <label><input type="checkbox" name="carbo" value="Batata Doce" onclick="checkLimit(this, 2)"> Batata Doce</label>
            <label><input type="checkbox" name="carbo" value="Feij√£o" onclick="checkLimit(this, 2)"> Feij√£o</label>
        </div>

        <h3 class="section-title">2. Prote√≠nas (Prefer√™ncias)</h3>
        <div class="options-grid">
            <label><input type="checkbox" name="prot" value="Carne de Panela"> Carne de Panela</label>
            <label><input type="checkbox" name="prot" value="Carne Mo√≠da"> Carne Mo√≠da</label>
            <label><input type="checkbox" name="prot" value="Bife Acebolado"> Bife Acebolado</label>
            <label><input type="checkbox" name="prot" value="Strogonoff de Carne"> Strogonoff de Carne</label>
            <label><input type="checkbox" name="prot" value="Frango Sobrecoxa Assada"> Frango Sobrecoxa Assada</label>
            <label><input type="checkbox" name="prot" value="Frango Sobrecoxa Ensopada"> Frango Sobrecoxa Ensopada</label>
            <label><input type="checkbox" name="prot" value="Fil√© de Frango Grelhado"> Fil√© de Frango Grelhado</label>
            <label><input type="checkbox" name="prot" value="Frango Desfiado Ensopado"> Frango Desfiado Ensopado</label>
            <label><input type="checkbox" name="prot" value="Strogonoff de Frango"> Strogonoff de Frango</label>
        </div>

        <h3 class="section-title">3. Legumes (M√°x 3)</h3>
        <div class="options-grid">
            <label><input type="checkbox" name="legume" value="Br√≥colis" onclick="checkLimit(this, 3)"> Br√≥colis</label>
            <label><input type="checkbox" name="legume" value="Couve Mineira" onclick="checkLimit(this, 3)"> Couve Mineira</label>
            <label><input type="checkbox" name="legume" value="Couve-flor" onclick="checkLimit(this, 3)"> Couve-flor</label>
            <label><input type="checkbox" name="legume" value="Vagem" onclick="checkLimit(this, 3)"> Vagem</label>
            <label><input type="checkbox" name="legume" value="Abobrinha Verde" onclick="checkLimit(this, 3)"> Abobrinha Verde</label>
            <label><input type="checkbox" name="legume" value="Cenoura" onclick="checkLimit(this, 3)"> Cenoura</label>
        </div>

        <h3 class="section-title">Seus Dados</h3>
        <input type="text" id="clienteNome" placeholder="Seu Nome Completo" style="width:95%; padding:15px; border:1px solid #ccc; border-radius:8px; margin-bottom:10px;">
        <input type="text" id="obs" placeholder="Observa√ß√µes (opcional)" style="width:95%; padding:15px; border:1px solid #ccc; border-radius:8px;">

        <button type="button" id="btnFinalizar" onclick="compartilharPedido()">
            üì≤ Enviar Pedido no WhatsApp
        </button>
    </form>
</div>

<div id="pedido-imagem">
    <div style="text-align:center; border-bottom:2px dashed #D65A18; padding-bottom:10px; margin-bottom:10px;">
        <h2 style="margin:0; color:#D65A18; font-size:24px;">JO DEL√çCIAS</h2>
        <p style="margin:0; font-size:14px;">PEDIDO DELIVERY</p>
    </div>
    <p><strong>Cliente:</strong> <span id="img-nome"></span></p>
    <p><strong>Data:</strong> <span id="img-data"></span></p>
    <hr style="border:1px solid #eee;">
    
    <div style="background:#eee; padding:5px; font-weight:bold;">CARBOIDRATOS (2):</div>
    <ul id="img-carbos"></ul>
    
    <div style="background:#eee; padding:5px; font-weight:bold;">PROTE√çNAS:</div>
    <ul id="img-prots"></ul>
    
    <div style="background:#eee; padding:5px; font-weight:bold;">LEGUMES (3):</div>
    <ul id="img-legumes"></ul>
    
    <hr style="border:1px solid #eee;">
    <p><strong>Obs:</strong> <span id="img-obs"></span></p>
    <div style="background:#D65A18; color:white; padding:10px; text-align:center; margin-top:15px; font-weight:bold;">
        PACOTE 10 UNIDADES
    </div>
</div>

<script>
    // 1. Fun√ß√£o gen√©rica para limitar checkboxes
    function checkLimit(checkbox, limit) {
        const name = checkbox.name;
        const checked = document.querySelectorAll(`input[name="${name}"]:checked`);
        if (checked.length > limit) {
            alert(`Ops! Voc√™ s√≥ pode escolher at√© ${limit} op√ß√µes nesta categoria.`);
            checkbox.checked = false;
        }
    }

    async function compartilharPedido() {
        const nome = document.getElementById('clienteNome').value;
        if(!nome) { alert("Por favor, preencha seu nome antes de enviar."); return; }

        const btn = document.getElementById('btnFinalizar');
        btn.innerText = "Gerando imagem...";
        btn.disabled = true;

        // Preenche os dados no template oculto
        document.getElementById('img-nome').innerText = nome;
        document.getElementById('img-data').innerText = new Date().toLocaleDateString();
        document.getElementById('img-obs').innerText = document.getElementById('obs').value || "-";

        const getItems = (name) => Array.from(document.querySelectorAll(`input[name="${name}"]:checked`))
                                     .map(e => `<li>${e.value}</li>`).join('');
        
        document.getElementById('img-carbos').innerHTML = getItems('carbo') || "<li>Sem prefer√™ncia</li>";
        document.getElementById('img-prots').innerHTML = getItems('prot') || "<li>Padr√£o</li>";
        document.getElementById('img-legumes').innerHTML = getItems('legume') || "<li>Sem legumes</li>";

        // Gera a imagem
        const canvas = await html2canvas(document.getElementById('pedido-imagem'));
        
        // Converte o canvas para arquivo (Blob)
        canvas.toBlob(async (blob) => {
            const file = new File([blob], `pedido_${nome}.png`, { type: 'image/png' });
            
            // Tenta usar o compartilhamento nativo (celular)
            if (navigator.share) {
                try {
                    await navigator.share({
                        files: [file],
                        title: 'Meu Pedido Jo Del√≠cias',
                        text: `Ol√°! Segue meu pedido de marmitas.`
                    });
                    btn.innerText = "Pedido Enviado!";
                } catch (error) {
                    console.log('Erro ao compartilhar ou cancelado:', error);
                    fallbackDownload(canvas, nome); // Se falhar, baixa a imagem
                }
            } else {
                // Se estiver no PC (onde navigator.share raramente funciona com imagens)
                fallbackDownload(canvas, nome);
            }
            
            btn.disabled = false;
            setTimeout(() => btn.innerText = "üì≤ Enviar Pedido no WhatsApp", 3000);
        });
    }

    function fallbackDownload(canvas, nome) {
        // Fallback: Baixa a imagem e abre o link de texto do WhatsApp
        const link = document.createElement('a');
        link.download = `Pedido_${nome}.png`;
        link.href = canvas.toDataURL();
        link.click();
        
        const tel = "5548984741168"; // Telefone do PDF
        alert("Como seu navegador n√£o suporta envio direto de imagem, ela foi baixada! Anexe-a no WhatsApp que vai abrir.");
        window.open(`https://wa.me/${tel}?text=Ol√°! Baixei a imagem do meu pedido e estou enviando em anexo.`, '_blank');
    }
</script>

</body>
</html>